#include <SoftwareSerial.h>
SoftwareSerial mySerial(10, 11); // RX, TX

// ----------------- Funciones para reconstruir floats y checksum -----------------
float leerFloat(byte* mensaje, int indice) {
  union {
    float f;
    byte b[4];
  } data;
  for (int i = 0; i < 4; i++) {
    data.b[i] = mensaje[indice + i];
  }
  return data.f;
}

byte calcularChecksum(byte* mensaje, int largo) {
  int suma = 0;
  for (int i = 0; i < largo; i++) {
    suma += mensaje[i];
  }
  return suma % 256;
}

void setup() {
  Serial.begin(9600);
  mySerial.begin(9600);
}

void loop() {
  const int largoDatos = 8; // 2 floats * 4 bytes
  byte mensaje[largoDatos + 1]; // +1 para checksum

  if (mySerial.available() >= (largoDatos + 1)) {
    mySerial.readBytes(mensaje, largoDatos + 1);

    byte checksumRecibido = mensaje[largoDatos];
    byte checksumCalculado = calcularChecksum(mensaje, largoDatos);

    if (checksumRecibido == checksumCalculado) {
      // Reconstruir floats
      float h = leerFloat(mensaje, 0);
      float t = leerFloat(mensaje, 4);

      Serial.print("Humedad: ");
      Serial.print(h);
      Serial.print("%\t");
      Serial.print("Temperatura: ");
      Serial.println(t);
    } else {
      Serial.println("Mensaje corrupto, checksum no coincide");
    }
  }
}
